# Canards Processor Board Firmware
Firmware for the 2024-2025 processor board, performing state estimation and control for the canards system. Project documentation can be found in the team Google Drive.

## Project Structure
- `src/drivers/`: custom peripheral driver modules
- `src/application/`: high-level application logic modules
- `src/third_party/`: third-party libraries
- `src/common/`: shared resources specific to this project
- `tests/`: everything for [testing](#Unit-Testing)
- Everything else is autogenerated by STM32CubeIDE with few modifications

## Developer Setup
This project is not dependent on STM32CubeIDE. It uses a custom cmake setup and accompanying vscode devcontainer. However, the project is compatible with STM32CubeIDE as a cmake project for integrated flashing/debugging.

#### 1. Clone repo
- Clone repo and initialize submodules: ```
   git clone --recurse-submodules https://github.com/waterloo-rocketry/cansw_processor_canards ```

#### 2. Editing and Unit Testing
Vscode devcontainers is preferred for editing and running gtest since it provides a consistent environment. Most software development should occur in here.
- Open the project using [vscode devcontainer](https://code.visualstudio.com/docs/devcontainers/tutorial)


#### 3. Flashing and Integrated Debugging
CubeIDE is preferred for flashing/debugging for its integration with STM32 hardware. Unit tests can't be run from CubeIDE.
- Import the project into STM32CubeIDE (version 1.16.1 recommended)
- Use an ST-Link programmer to connect to processor board.
- Build, run, or debug the same as a standard CubeIDE project

#### *ALTERNATIVE 3. Vscode STM32 extension*
*The STM32 vscode extension supports flashing and integrated debugging from vscode. This was omitted from the devcontainer to avoid dealing with passthrough. [This page](https://community.st.com/t5/stm32-mcus/how-to-use-vs-code-with-stm32-microcontrollers/ta-p/742589) has instructions for setting this up manually if desired.*

## Build Project and Run Tests
Excecute `/scripts/run.sh` from inside the devcontainer to build the project and run unit tests.
- Show script usage:

  ```bash
  ./scripts/run.sh help
  ```
Note: building using this script builds into the directory `build/[target name]`. Building using STM32CubeIDE builds into `build/` directly (for some reason trying to change this caused an error. WIP). Thus, building with the script can only be used to verify that code compiles. It will not affect STM32CubeIDE flashing/debugging builds.

## Testing
The project uses GoogleTest and Fake Function Framework (fff) for unit testing. All testing-related files are in `tests/`.
- Tests are built from `tests/CMakeLists.txt` which is separate from the main project's build config. Building and running tests is done from `scripts/run.sh` described above.
- Test source code should be written in `tests/unit/`.
- Mocks should be made with fff in `tests/mocks/`
